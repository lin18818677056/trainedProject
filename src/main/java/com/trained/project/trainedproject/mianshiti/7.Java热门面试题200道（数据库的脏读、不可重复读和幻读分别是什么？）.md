**数据库的脏读、不可重复读和幻读分别是什么？**

# Java热门面试题200道

## 7. 数据库的脏读、不可重复读和幻读分别是什么？

## 面试答案

脏读、不可重复读和幻读是数据库事务隔离级别中涉及的三个重要概念，它们都与并发事务执行时可能出现的数据一致性问题有关。

### 脏读（Dirty Read）

**定义**：一个事务读取了另一个未提交事务修改但尚未提交的数据。

**场景示例**：
- 事务A修改了一条数据，但尚未提交
- 事务B读取了事务A修改后的数据
- 如果事务A回滚，那么事务B读取到的就是"脏"数据

**问题**：读取到了实际上并不存在的数据状态

### 不可重复读（Non-repeatable Read）

**定义**：在同一个事务中，多次读取同一数据返回的结果不一致，这是因为另一个已提交事务在期间修改了该数据。

**场景示例**：
- 事务A读取某条记录
- 事务B修改了该记录并提交
- 事务A再次读取同一条记录，发现与第一次读取的结果不同

**问题**：同一事务中对同一数据的多次读取结果不一致

### 幻读（Phantom Read）

**定义**：在同一个事务中，多次执行相同的查询返回的记录数不一致，这是因为另一个已提交事务在期间插入或删除了符合条件的记录。

**场景示例**：
- 事务A查询某个范围内的记录，得到10条结果
- 事务B插入了一条符合该范围条件的新记录并提交
- 事务A再次执行相同查询，得到11条结果

**问题**：同一事务中相同查询条件返回的结果集不一致

### 三者对比

| 问题类型 | 描述 | 涉及操作 | 数据状态 |
|---------|------|---------|---------|
| 脏读 | 读取未提交数据 | 修改 | 不一致 |
| 不可重复读 | 同一数据多次读取结果不同 | 修改 | 已提交 |
| 幻读 | 相同查询返回记录数不同 | 插入/删除 | 已提交 |

### 解决方案

数据库通过设置不同的事务隔离级别来解决这些问题：

1. **READ UNCOMMITTED（读未提交）**：最低隔离级别，所有问题都可能出现
2. **READ COMMITTED（读已提交）**：解决脏读问题
3. **REPEATABLE READ（可重复读）**：解决脏读和不可重复读问题
4. **SERIALIZABLE（串行化）**：最高隔离级别，解决所有问题

### 实际应用建议

- 根据业务需求选择合适的隔离级别
- 高并发场景下需要在数据一致性和性能之间权衡
- MySQL默认使用REPEATABLE READ隔离级别
- Oracle等数据库默认使用READ COMMITTED隔离级别

理解这三种读现象有助于在实际开发中正确设置事务隔离级别，确保数据的一致性和系统的性能。