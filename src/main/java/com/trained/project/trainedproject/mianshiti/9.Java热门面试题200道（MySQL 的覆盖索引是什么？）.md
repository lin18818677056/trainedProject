MySQL 的覆盖索引是什么？

# Java热门面试题200道

## 9. MySQL 的覆盖索引是什么？

### 概念定义

覆盖索引（Covering Index）是指查询语句中涉及的所有字段都能通过某个索引获取，而无需回表查询原始数据行的索引。换句话说，索引本身包含了查询所需的所有数据，不需要再次访问数据页。

### 工作原理

在 MySQL 中，通常的索引结构（如 B+ 树）只包含索引列的值和指向数据行的主键值。当执行查询时，如果使用了非覆盖索引，MySQL 需要先在索引中查找，然后通过主键值再次访问数据页获取完整行数据，这个过程称为"回表"。

而覆盖索引包含了查询所需的所有字段，可以直接从索引中返回结果，避免了回表操作，从而大大提高了查询性能。

### 覆盖索引的优势

1. **减少 I/O 操作**：避免了回表操作，减少了磁盘 I/O 次数
2. **提高查询性能**：索引通常比数据行小，读取更快
3. **减少内存使用**：索引占用的内存通常比数据页少
4. **减轻锁竞争**：减少对数据页的访问，降低锁竞争概率

### 使用场景

覆盖索引适用于以下情况：
- 经常查询的列数量较少
- WHERE 条件和 SELECT 字段可以被同一索引覆盖
- 统计类查询，如 COUNT、SUM 等聚合操作

### 示例

假设有一个用户表：

``` sql
CREATE TABLE users (
 id INT PRIMARY KEY, 
 name VARCHAR(50), 
 age INT,
 city VARCHAR(50),
 INDEX idx_city_age (city, age) 
);


```



查询语句：
``` sql
-- 使用覆盖索引
SELECT city, age FROM users WHERE city = '北京';

-- 未使用覆盖索引，需要回表
SELECT id, name FROM users WHERE city = '北京';

```



第一条查询可以直接从索引 idx_city_age 中获取所需数据，而第二条查询需要通过索引找到记录后再回表获取 id 和 name 字段。

### 如何判断是否使用了覆盖索引

可以使用 `EXPLAIN` 命令查看执行计划，如果 `Extra` 列显示 `Using index`，则表示使用了覆盖索引。

### 注意事项

1. 覆盖索引虽然能提高查询性能，但也会增加存储空间和维护成本
2. 索引并非越多越好，需要根据实际查询需求来设计
3. 当表数据频繁更新时，过多的索引会影响写入性能
